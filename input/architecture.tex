
\section{Architecture}
\label{sec:architecture}

\begin{figure}
  \centering
  \input{input/figurearchitecture.tex}
  \caption{\label{fig:architecture} Four layers architecture of \CRATE.}
\end{figure}

\CRATE is based on the optimistic replication scheme. Thus, each editor
replicates the document locally and directly performs operations on it. Next,
changes are spread to all other participants. When the same set of operations
are applied by editors, the replicates converge to an equivalent state allowing
users to read the same document.  This property is called \emph{strong eventual
  consistency}~\cite{bailis2013eventual}.

\CRATE uses a Conflict-free Replicated Data Type (CRDT) for sequences to ensure
strong eventual consistency on the
document~\cite{shapiro2011comprehensive}. They ensure consistency at the price
of a unique identifier attached to each element of the sequence. Recently,
\LSEQ~\cite{nedelec2013lseq} proposed a strategy to bound the space complexity
of these identifiers to $\mathcal{O}(\log(d)^2)$ where $d$ is the document
size. This result avoids to run costly distributed garbage-collection-like
mechanisms to maintain the efficiency of the editor.

Eventual consistency requires that all operations are received by all editing
session members.  \CRATE builds an editing session using
\SPRAY~\cite{nedelec2015spray}, a random peer sampling
protocol~\cite{jelasity2007gossip} (RPS) built on top of WebRTC. A peer sampling
protocol provides each network member with a partial view of the network
significantly smaller compared to this latter. Maintaining this partial view
random ensures the connectivity of the network. Unlike prior RPS, \SPRAY allows
adapting the partial view sizes to the editing session size without measuring
its number of participants. Since the propagation protocol of messages
extensively uses these tables, the network traffic inherits from this
scalability. Consequently, \CRATE adapts its operation to the need of the
editing session size.


The distributed and decentralized \textsc{c}ollabo\textsc{rat}ive
\textsc{e}ditor \CRATE developed in web languages only: HTML, CSS, and mostly
JavaScript. As shown in Figure~\ref{fig:architecture}, \CRATE comprises four
layers:
\begin{itemize}
\item [\textbf{The graphical user interface}] that renders the document to the users
  (cf. Figure~\ref{img:screenshot}). Each local update is immediately applied to
  the document view for real-time sake. Then, the update is applied to the
  replicated data type;
\item [\textbf{The sequence structure layer}] that represents the local document
  (cf. ยง\ref{sec:structure}). It is in charge of providing the metadata
  necessary to order each character identically anywhere;
\item [\textbf{The causality layer}] that tracks semantic causality between operations,
  e.g., the removal of a character cannot precede its insertion;
\item [\textbf{The network layer}] that
  \begin{inparaenum}[(i)]
  \item builds a network of browsers for each editing session and
  \item uses it to propagate the updates to all collaborators
    (cf. ยง\ref{sec:network}).
  \end{inparaenum}
\end{itemize}



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
